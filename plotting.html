<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plotting</title>
  <link rel="stylesheet" href="plotting.css" />
  <style>
    /* Disembunyikan saat cek auth, ditampilkan ulang oleh auth-guard.js */
    html { visibility: hidden; }
    /* Utility */
    .hidden { display: none !important; }
  </style>
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32.png">
  <link rel="icon" type="image/png" sizes="48x48" href="icons/favicon-48.png">
  <link rel="icon" type="image/png" sizes="64x64" href="icons/favicon-64.png">
  <link rel="icon" type="image/png" sizes="128x128" href="icons/favicon-128.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/favicon-192.png">
  <link rel="icon" type="image/png" sizes="256x256" href="icons/favicon-256.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/favicon-512.png">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  <link rel="manifest" href="manifest.json" type="application/manifest+json">
</head>
<body>

  <!-- App Bar -->
  <header class="app-bar" role="banner">
    <a class="back-btn" aria-label="Kembali" href="#" onclick="safeBackTo('index.html');return false;">
      <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26"
           viewBox="0 0 24 24" fill="none" stroke="currentColor"
           stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </a>
    <h1 class="app-title">Plotting Tugas</h1>
  </header>

  <!-- Kartu Jam & Next Rotation -->
  <div class="header-card">
    <div class="header-top">
      <span id="connDot" class="conn-dot" aria-hidden="true"></span>
    </div>
    <div id="clock" class="clock">00:00:00</div>
    <div class="next-info">Perputaran selanjutnya <span id="nextRotation">-</span></div>
  </div>

  <!-- Tombol Lokasi -->
  <div class="site-bar">
    <button id="pscpBtn"  class="site-btn stop" type="button">PSCP</button>
    <button id="hbscpBtn" class="site-btn stop" type="button">HBSCP</button>
  </div>

  <!-- Kontrol Rotasi -->
  <div class="controls">
    <button id="startBtn" class="start" type="button">Mulai Rotasi</button>
    <button id="stopBtn"  class="stop" type="button" disabled>Hentikan</button>
    <button id="nextBtn"  type="button" disabled>Majukan 1x</button>

    <!-- Download PDF mengikuti lokasi aktif -->
    <button id="downloadPdfBtn" class="download" type="button" disabled>ðŸ“„ Download PDF</button>
  </div>

  <!-- Tabel penugasan -->
  <table class="assign hidden" aria-label="Tabel Penugasan">
    <thead>
      <tr><th>Posisi</th><th>Nama</th></tr>
    </thead>
    <tbody id="assignRows"></tbody>
  </table>

    <!-- Petugas -->
    <div class="manage" aria-label="Petugas">
      <h2 id="manageTitle">Petugas</h2>

      <table class="people" aria-label="Daftar Personil">
      <thead>
        <tr><th>Nama</th><th>Spesifikasi</th></tr>
      </thead>
      <tbody id="peopleRows"></tbody>
    </table>
  </div>

  <!-- Bottom Sheet (opsional untuk notifikasi koneksi) -->
  <div id="sheetBackdrop" class="sheet-backdrop hidden"></div>
  <div id="bottomSheet" class="sheet hidden" role="dialog" aria-live="polite" aria-modal="true">
    <div class="sheet-header"><strong>Internet Connection</strong></div>
    <div id="sheetMsg" class="sheet-body"></div>
  </div>

  <!-- Auth guard: load SEBELUM plotting.js -->
  <script type="module">
    import { requireAuth } from "./auth-guard.js";
    // Jika ingin wajib email terverifikasi, tambahkan: requireEmailVerified: true
    requireAuth({ loginPath: "index.html", hideWhileChecking: true });
  </script>

  <!-- Logic utama plotting (rotasi, tulis RTDB, kirim ke Sheet, download PDF) -->
  <script type="module" src="plotting.js"></script>
  <script src="back.js"></script>
</body>
</html>
